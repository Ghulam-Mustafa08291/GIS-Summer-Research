\documentclass[preprint,12pt]{elsarticle}

\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{float} % Add this package for better figure control

\journal{Remote Sensing Applications: Society and Environment}

\begin{document}

\begin{frontmatter}

\title{District-Level Weather Anomalies in Pakistan: Historical Patterns, Near-Real-Time Monitoring, and Forecast-Based Anomaly Detection}

\author{Ghulam Mustafa}

\affiliation{organization={Habib University}, 
            city={Karachi},
            country={Pakistan}}

%% Abstract
\begin{abstract}
The paper presents a suite of four related Google Earth Engine applications that track long-term trends in rainfall and temperature anomalies across all districts of Pakistan, provide near real-time monitoring of weather anomalies, compare forecast data with historical baselines, and compute cumulative anomaly scores by combining recent past conditions with future forecasts. These applications utilize the ERA5-Land Monthly Aggregated dataset (1981--present) for historical climatology and the GFS (Global Forecast System) 384-Hour Predicted Atmosphere Data for 16-day weather forecasts. The applications compute climatological baselines and identify anomalous conditions for each district through threshold-based detection and difference-based visualization. They visualize trends, anomaly counts, forecast deviations, and cumulative risk scores through time-series charts and spatial maps. These tools are intended to support data-driven climate resilience planning as well as climate-aware operations in the domains of agriculture, water management, and disaster preparedness. A case study of the 2010 floods is presented to demonstrate the utility of the tools.
\end{abstract}

%% Graphical abstract
\begin{graphicalabstract}
% \includegraphics{graphical-abstract.png}
\end{graphicalabstract}

%% Research highlights
\begin{highlights}
\item Application 1: Long-term historical anomaly pattern analysis using ERA5-Land dataset (1981–present).
\item Application 2: Near real-time monitoring comparing current conditions with historical baselines.
\item Application 3: 16-day forecast anomaly detection using GFS data compared with historical averages.
\item Application 4: Cumulative anomaly score combining past months' deviations with forecast anomalies.
\item Case study: 2010 Pakistan floods demonstrate early warning potential.
\end{highlights}

%% Keywords
\begin{keyword}
climate anomalies \sep ERA5-Land Dataset \sep Pakistan weather patterns \sep Google Earth Engine \sep flood early warning
\end{keyword}

\end{frontmatter}

%% ---------------- Main Text ----------------

\section{Introduction}
- Background on climate change impacts in Pakistan.  
- Importance of detecting rainfall and temperature anomalies.  
- Role of Google Earth Engine for large-scale monitoring.  
- Contributions of this paper (apps + case study).

\section{Related Work}
Several platforms and tools have been developed for climate monitoring and anomaly detection at various spatial scales. This section reviews existing global platforms and Pakistan-specific tools, identifying gaps that motivate the present work.

\subsection{Global Platforms}
\textbf{Climate Engine} (https://climateengine.org) is a web-based platform built on Google Earth Engine that provides access to climate and remote sensing data including ERA5 (1979--present, 0.25° resolution), Landsat, and MODIS datasets. Developed through a collaboration between the Desert Research Institute, University of California Merced, and Google, the platform enables users to generate maps of average temperature and precipitation values over custom date ranges, compute deviations from long-term baseline means, and calculate drought indices such as SPI, SPEI, EDDI, and PDSI directly within the application. While the platform can display temperature and rainfall anomalies for Pakistan at the country level, it does not provide district-level analysis, district-specific time-series visualizations, or forecast-based anomaly detection using GFS data.

\textbf{FAO GIEWS Earth Observation} (https://www.fao.org/giews/earthobservation/) provides near real-time monitoring of agricultural conditions with updates every 10 days (dekadal). The platform offers precipitation anomaly maps showing differences between current rainfall and long-term averages, using data from the European Centre for Medium-Range Weather Forecasts (ECMWF). It also includes vegetation indices (NDVI, VCI, VHI), Agricultural Stress Index, and historic drought frequency analysis. While it covers Pakistan at the country level and provides precipitation anomalies, it does not offer temperature anomaly products or district-level spatial granularity.

\textbf{Climate Toolbox} (https://climatetoolbox.org) offers a suite of interactive web tools for mapping and analyzing historical and projected climate data across the United States. It uses GridMET and PRISM datasets to provide county-level analysis with forecasts extending up to 7 months, and baseline periods varying by tool: historical tools use 1981--2010 as the reference period, while future projection comparisons use 1971--2000. Similarly, the \textbf{West Wide Drought Tracker} (https://wrcc.dri.edu/wwdt/) provides monthly drought indices including Palmer Drought Severity Index (PDSI) as well as mean precipitation and temperature displayed as time-series graphs, using PRISM data for the western United States at county-level resolution. Both tools demonstrate the utility of sub-national climate monitoring with time-series capabilities but are geographically limited to the US.

\subsection{Pakistan-Specific Tools}
\textbf{ICIMOD National Agricultural Drought Watch for Pakistan} (https://tethys.icimod.org/apps/droughtpk/) was developed under the SERVIR Hindu Kush Himalaya Initiative to provide district-level drought monitoring. The platform uses CHIRPS precipitation data and MODIS imagery to compute indices including evapotranspiration, Standardized Precipitation Index (SPI), soil moisture, and temperature extremes, with current conditions, seasonal analysis, and 9-month forecast outlook. However, at the time of writing, the application appears to have responsiveness issues. While this tool was designed for district-level analysis, it focuses specifically on agricultural drought rather than general temperature and precipitation anomalies, and relies on different datasets than the ERA5 and GFS used in the present study.

The \textbf{Pakistan Meteorological Department (PMD)} (https://www.pmd.gov.pk) provides official weather forecasts and climate data for Pakistan. Short-term forecasts (3-day) are provided at the provincial level, while monthly forecasts include district-level maps for both rainfall and temperature. The monthly products show baseline normal values (using 1991--2020 as the reference period) and anomaly maps indicating deviations from this baseline for each district. However, PMD does not provide interactive web-based applications for custom analysis, historical pattern exploration, or integration with GFS forecast data for 16-day anomaly detection.

The \textbf{NDMA Disaster Alert} mobile application developed by Pakistan's National Disaster Management Authority provides district-level alerts for various hazards including floods, heatwaves, earthquakes, and smog. While it offers district-level alert information and GIS-based mapping, it focuses exclusively on current disaster alerting rather than systematic anomaly analysis. The application does not provide historical time-series analysis, pattern visualization, forecast comparison with historical baselines, or cumulative anomaly scoring.

\subsection{Research Gap}
The review of existing tools reveals critical gaps in the availability of interactive, district-level climate anomaly analysis for Pakistan:

\begin{enumerate}
    \item \textbf{Lack of Short-Term Forecast Anomaly Detection:} While PMD provides monthly district-level anomaly maps, no existing Pakistan-focused tool enables users to compare 16-day GFS weather forecasts with historical climatological baselines in an interactive format. This capability is essential for early warning and proactive decision-making in agriculture, water management, and disaster preparedness.
    
    \item \textbf{No Cumulative Risk Assessment:} Existing tools analyze historical conditions or forecast data in isolation. No tool provides a cumulative anomaly score that combines recent observed deviations with anticipated forecast anomalies to assess ongoing and emerging climate risk---a critical need for understanding persistent or developing hazardous conditions.
    
    \item \textbf{Limited Interactive Analysis:} Although some platforms provide district-level information, they typically deliver static reports or maps rather than interactive web applications. Users cannot explore custom date ranges, click on individual districts for detailed information, or generate on-demand time-series visualizations.
    
    \item \textbf{Fragmented Coverage Across Multiple Platforms:} Currently, users must consult multiple disparate platforms to access historical patterns, near real-time conditions, and forecasts. No single suite of tools provides comprehensive coverage of all analysis modes (historical, near real-time, forecast, and combined) for Pakistan at the district level.
\end{enumerate}

The four applications developed in this study directly address these gaps. By leveraging Google Earth Engine's cloud computing capabilities with ERA5-Land historical data and GFS forecast data, these tools provide: (1) interactive district-level analysis for all 150+ districts of Pakistan, (2) threshold-based historical anomaly detection with customizable parameters, (3) near real-time monitoring comparing current conditions with historical baselines, (4) 16-day forecast anomaly detection unavailable in any existing Pakistan-focused tool, and (5) a novel cumulative anomaly score combining past and forecast deviations for holistic risk assessment. Together, these applications empower researchers, policymakers, and practitioners with actionable climate intelligence for data-driven decision-making.

\section{Data and Methods}
\subsection{Datasets}
This study utilizes two primary datasets for climate analysis and forecasting:

\textbf{ERA5-Land Monthly Aggregated Dataset (1981–present):} ERA5-Land is a reanalysis dataset produced by the European Centre for Medium-Range Weather Forecasts (ECMWF). It provides global land surface variables at approximately 9~km (0.1°) spatial resolution. This study uses the monthly aggregated version available through Google Earth Engine, specifically extracting the \texttt{total\_precipitation\_sum} (total monthly precipitation in meters) and \texttt{temperature\_2m} (air temperature at 2 meters above the surface in Kelvin) bands. The dataset's long temporal coverage (1981–present) enables robust climatological baseline calculations.

\textbf{GFS: Global Forecast System 384-Hour Predicted Atmosphere Data:} The GFS is a global numerical weather prediction system operated by the National Oceanic and Atmospheric Administration (NOAA). It provides forecast data at 0.25° spatial resolution with predictions extending up to 384 hours (16 days) into the future. This study uses the \texttt{precipitation\_rate} (kg/m²/s) and \texttt{temperature\_2m\_above\_ground} (K) variables. Hourly forecasts are available for the first 120 hours, followed by 3-hourly forecasts for hours 123–384.

\subsection{Study Area}
The study area encompasses all districts of Pakistan, providing district-level spatial resolution for climate anomaly analysis. Pakistan's diverse geography includes multiple climate zones ranging from arid and semi-arid regions in the south and west to humid subtropical and alpine climates in the north. This climatic diversity makes district-level analysis essential for capturing localized weather patterns and anomalies.

\subsection{Anomaly Detection Methods}
The applications employ three complementary approaches for anomaly detection:

\textbf{Threshold-Based Anomaly Detection (Application 1):} For long-term historical analysis, anomalies are identified by first computing the long-term monthly climatology for rainfall and temperature using a 30-year baseline period (1991–2020). For each district and each month, the average climatological baseline is established. User-defined thresholds (above and below, expressed as percentages) are then applied to create an acceptable range around this baseline. Any observed monthly value lying outside this range is flagged as an anomaly. This approach enables counting and tracking anomaly frequency over time.

\textbf{Difference-Based Visualization (Applications 2 and 3):} For near real-time monitoring and forecast-based analysis, the applications compute the direct difference between current/forecast values and historical averages without applying percentage thresholds. These differences are visualized on a continuous color scale where blue indicates values below the historical average, green indicates values near the historical average, and red indicates values above the historical average. This approach provides an intuitive visual representation of how current or forecast conditions deviate from expected climatological norms.

\textbf{Cumulative Anomaly Scoring (Application 4):} For combined risk assessment, the application computes a cumulative anomaly score by summing the deviations from historical averages across both recent past months (from ERA5) and the upcoming 16-day forecast period (from GFS). This additive approach captures the combined effect of ongoing and anticipated anomalous conditions, providing a holistic measure of cumulative climate risk for each district.

\subsection{Application 1: District-Level Temperature and Rainfall Anomalies in Pakistan: Historical Pattern Analysis}
This application is designed to analyze long-term patterns of anomalies across districts. The user can:
\begin{itemize}
    \item Select a district from a dropdown menu.
    \item Specify a start year and an end year for analysis.
    \item Set anomaly thresholds (above and below) for both rainfall and temperature.
\end{itemize}

The application performs the following steps:
\begin{enumerate}
    \item \textbf{Load ERA5-Land Dataset}: The application loads the ERA5-Land Monthly Aggregated dataset containing total precipitation and temperature bands for the period 1984--present.
    \item \textbf{Compute Climatological Baseline}: For the selected district, the application calculates baseline monthly averages using a 30-year reference period (1991--2020). This baseline represents the expected climatological values for each month.
    \item \textbf{Extract Monthly Values}: For each year in the user-specified analysis period, the application extracts monthly rainfall (converted to mm) and temperature (converted to Celsius) values for the selected district geometry using spatial reduction operations.
    \item \textbf{Calculate Analysis Period Averages}: Monthly averages are computed specifically for the user-selected year range, providing the average rainfall and temperature for each month across the analysis period.
    \item \textbf{Define Anomaly Thresholds}: Upper and lower bounds for acceptable values are calculated by applying the user-defined percentage thresholds to the baseline averages. For example, if the baseline for July rainfall is 100mm and the user sets a 20\% threshold, values outside the 80--120mm range are flagged as anomalies.
    \item \textbf{Count Anomalies Per Year}: For each year in the analysis period, the application counts how many months had rainfall or temperature values exceeding the defined thresholds.
    \item \textbf{Generate Visualizations}: The application outputs:
    \begin{itemize}
        \item Average monthly rainfall time-series chart.
        \item Average monthly temperature time-series chart.
        \item Count of rainfall anomalies per year.
        \item Count of temperature anomalies per year.
        \item A combined anomalies trend graph showing both rainfall and temperature anomaly counts over time.
    \end{itemize}
\end{enumerate}

This application enables researchers to identify districts with increasing or decreasing anomaly trends and to understand seasonal patterns in climate variability.

\subsection{Application 2: District-Level Temperature and Rainfall Anomalies in Pakistan: Near Real-Time Monitoring}
This application focuses on near real-time anomaly monitoring across Pakistan. The user can:
\begin{itemize}
    \item Select a parameter (rainfall or temperature).
    \item Choose a month from the latest three available months (dynamically populated based on ERA5 data availability).
\end{itemize}

The application performs the following steps:
\begin{enumerate}
    \item \textbf{Fetch Latest Data}: The application queries the ERA5-Land Monthly Aggregated dataset and retrieves the three most recent monthly images based on their timestamps.
    \item \textbf{Populate Month Dropdown}: The month names are dynamically extracted from the retrieved images and displayed in the dropdown menu, with the most recent month labeled as ``Latest.''
    \item \textbf{Load Pre-computed Historical Averages}: Historical monthly averages for each district (computed from 2014--2024 ERA5 data) are stored as a GEE Feature Collection asset and loaded for comparison.
    \item \textbf{Extract Current Values}: For the user-selected month, the application extracts the current rainfall (in mm) or temperature (in Celsius) for each district using mean reduction over the district geometry.
    \item \textbf{Batch Processing}: To avoid browser timeouts with 150+ districts, the application processes districts in batches of 5, with a short delay between batches. This ensures stable execution even with limited computational resources.
    \item \textbf{Calculate Differences}: For each district, the difference between the current month's value and the corresponding historical monthly average is computed.
    \item \textbf{Determine Visualization Range}: The application calculates the maximum absolute difference across all districts to create a symmetric color scale centered at zero (historical average).
    \item \textbf{Visualize Results}: Districts are painted on the map with colors representing their deviation from historical averages:
    \begin{itemize}
        \item \textbf{Blue}: Current value significantly below historical average.
        \item \textbf{Green}: Current value near historical average.
        \item \textbf{Red}: Current value significantly above historical average.
    \end{itemize}
    \item \textbf{Interactive Click Handler}: Users can click on any district to view detailed information including the district name, current value, historical average, and the difference between them.
\end{enumerate}

This color-coded visualization allows users to rapidly identify districts experiencing unusual weather conditions in near real-time, supporting timely decision-making for agriculture, water management, and disaster response.

\subsection{Application 3: District-Level Weather Anomalies in Pakistan: Forecast}
This application compares 16-day weather forecasts from the GFS (Global Forecast System) dataset with pre-computed historical monthly averages to identify forecast-based anomalies across all districts of Pakistan. The user can:
\begin{itemize}
    \item Select a weather parameter (temperature or precipitation).
    \item Click the \textit{Visualize Forecast} button to generate the anomaly map.
\end{itemize}

The application performs the following steps:
\begin{enumerate}
    \item \textbf{Retrieve Forecast Data}: The application fetches the latest GFS forecast data covering the next 16 days (384 hours). For precipitation, it aggregates hourly and three-hourly precipitation rates across all forecast hours. For temperature, it computes the mean temperature across all forecast time steps.
    \item \textbf{Load Pre-computed Historical Averages}: Monthly historical averages for each district, computed from the ERA5-Land dataset (2014–2024), are stored as a GEE asset and loaded for comparison.
    \item \textbf{Handle Month Overlapping}: Since the 16-day forecast period may span two calendar months, the application calculates a weighted historical average. It determines the number of days falling within each month, retrieves the corresponding monthly historical values, and computes a proportionally weighted average to represent the expected 16-day historical baseline.
    \item \textbf{Compute Forecast Anomaly}: The difference between the 16-day forecast value and the 16-day equivalent historical average is calculated for each district.
    \item \textbf{Visualize Results}: Districts are color-coded on the map based on their anomaly values:
    \begin{itemize}
        \item \textbf{Blue}: Forecast value is below the historical average.
        \item \textbf{Green}: Forecast value is near the historical average.
        \item \textbf{Red}: Forecast value is above the historical average.
    \end{itemize}
\end{enumerate}

Users can click on any district to view detailed information including the 16-day forecast value, the 16-day historical equivalent average, and the difference between them. This application provides an early warning capability by identifying districts where upcoming weather conditions are expected to deviate significantly from historical norms.

\subsection{Application 4: District-Level Weather Anomalies in Pakistan: Forecast + History}
This application calculates a cumulative anomaly score by combining recent past conditions with future forecasts to provide a comprehensive risk assessment. The user can:
\begin{itemize}
    \item Select a weather parameter (temperature or precipitation).
    \item Select the past duration to include (last 1, 2, or 3 months).
    \item Click the \textit{Calculate Combined Anomalies} button to generate the cumulative risk map.
\end{itemize}

The application performs the following steps:
\begin{enumerate}
    \item \textbf{Calculate Past Anomalies (ERA5)}: For each of the user-selected past months, the application retrieves the observed monthly value from ERA5 and computes the difference from the corresponding historical monthly average. These individual month differences are summed to produce a total past anomaly score.
    \item \textbf{Calculate Forecast Anomaly (GFS)}: Using the same 16-day forecast methodology as Application 3, the application computes the difference between the forecast value and the 16-day historical equivalent, handling month overlaps with weighted averages.
    \item \textbf{Compute Cumulative Score}: The cumulative anomaly is calculated by summing the deviations of each selected past month from its historical average, and then adding the deviation of the 16-day forecast from its historical equivalent. For example, if the user selects 3 past months, the application sums the three individual monthly differences and adds the forecast difference to produce a single cumulative anomaly value for each district.
    \item \textbf{Visualize Results}: Districts are color-coded based on their cumulative anomaly score:
    \begin{itemize}
        \item \textbf{Blue}: Overall below-average conditions (past + forecast).
        \item \textbf{Green}: Overall near-average conditions.
        \item \textbf{Red}: Overall above-average conditions.
    \end{itemize}
\end{enumerate}

Users can click on any district to view a breakdown showing the past months' anomaly, the forecast anomaly, and the combined cumulative score. This application is particularly useful for identifying districts experiencing persistent anomalous conditions that are expected to continue, enabling proactive planning for agriculture, water management, and disaster preparedness.

\section{Results}
\subsection{Application 1: Historical Anomalies Explorer}
- Time-series graphs (rainfall, temperature, anomaly counts).  
- Visualization examples for selected districts.  

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{historicalpatterndistrictlevel.png}
    \caption{Visualization of district-level rainfall and temperature historical anomalies pattern for the time period of 1984 to 2000 in Abbotabad using the District Level Historical Analysis App.}
    \label{fig:historicalpattern-app}
\end{figure}

\subsection{Application 2: Real-Time Monitoring}
- Current status and preliminary outputs.  

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{district level near real time.png}
    \caption{Visualization of district-level rainfall anomalies for November 2025 using the Near Real-Time Monitoring application. Blue indicates below-average values, green indicates near-average values, and red indicates above-average values.}
    \label{fig:nearrealtime-app}
\end{figure}

\subsection{Application 3: Forecast-Based Anomaly Detection}
- Comparison of 16-day GFS forecast with historical averages.
- Early warning visualization for upcoming anomalous conditions.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{GFS forecast vs historical.png}
    \caption{Visualization of 16-day forecast anomalies for Pakistan using the Forecast Anomaly Detection App. Blue indicates forecast values below historical average, green indicates near-average values, and red indicates forecast values above historical average.}
    \label{fig:forecast-app}
\end{figure}

\subsection{Application 4: Combined Past + Forecast Anomaly}
- Cumulative anomaly visualization combining recent past and forecast deviations.
- Identifies districts with persistent anomalous conditions.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{combined_forecast_historical.png}
    \caption{Visualization of cumulative anomaly scores for Pakistan using the Combined Forecast + History App. The map shows the sum of past 3 months' deviations and the 16-day forecast anomaly. Blue indicates overall below-average conditions, green indicates near-average, and red indicates overall above-average conditions.}
    \label{fig:combined-app}
\end{figure}

\section{Case Study: 2010 Pakistan Floods}
- Brief background of the 2010 floods.  
- How anomaly detection captures pre-flood signals.  
- District-level anomaly patterns before/during flood.  
- Implications for early warning.  

\section{Discussion}
- Interpretation of results.  
- Limitations of current approach.  
- Future improvements (e.g., integrating forecasts, finer resolution).  

\section{Conclusion}
- Summary of contributions.  
- Potential applications in agriculture, water management, disaster preparedness.  
- Next steps for research.  

%% ---------------- References ----------------
\begin{thebibliography}{00}

\bibitem{lamport94}
  Leslie Lamport,
  \textit{\LaTeX: a document preparation system},
  Addison Wesley, Massachusetts,
  2nd edition,
  1994.

\end{thebibliography}

\end{document}
